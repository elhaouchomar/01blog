<div class="page-container">
    <app-navbar></app-navbar>

    <div class="content-wrapper">
        <!-- Sidebar -->
        <app-sidebar class="sidebar"></app-sidebar>

        <!-- Main Feed -->
        <main class="main-feed" *ngIf="user">
            <!-- Instagram Style Header -->
            <div class="insta-profile-header">
                <!-- Large Avatar Left -->
                <div class="header-avatar-col">
                    <div class="insta-avatar-wrapper">
                        <div class="insta-avatar-main" *ngIf="user.avatar"
                            [style.background-image]="'url(' + user.avatar + ')'">
                        </div>
                        <div class="insta-avatar-main avatar-initials" *ngIf="!user.avatar">
                            {{ getInitials(user.name) }}
                        </div>
                        <div class="status-ring hero" *ngIf="user.isOnline"></div>
                    </div>
                </div>

                <!-- Stats & Actions Right -->
                <div class="header-info-col">
                    <div class="info-top-row">
                        <h1 class="insta-username">@{{ user.handle }}</h1>
                        <div class="header-ctas">
                            <ng-container *ngIf="!isOwnProfile; else ownActions">
                                <button class="insta-btn-follow" [class.following]="user.isFollowing"
                                    (click)="toggleSubscribe()">
                                    {{ user.isFollowing ? 'Subscribed' : 'Subscribe' }}
                                </button>
                                <app-action-menu [items]="profileActions"
                                    (actionSelected)="handleDropdownAction($event)"></app-action-menu>
                            </ng-container>
                            <ng-template #ownActions>
                                <button class="insta-btn-secondary" routerLink="/settings">Edit Profile</button>
                                <button class="insta-btn-icon" routerLink="/settings">
                                    <span class="material-symbols-outlined">settings</span>
                                </button>
                            </ng-template>
                        </div>
                    </div>

                    <!-- Desktop Stats Row -->
                    <div class="info-stats-row" *ngIf="user.stats">
                        <span class="stat-item"><strong>{{ user.stats.posts }}</strong> posts</span>
                        <span class="stat-item"><strong>{{ user.stats.followers }}</strong> subscribers</span>
                        <span class="stat-item"><strong>{{ user.stats.following }}</strong> subscriptions</span>
                    </div>

                    <!-- Bio Section (Desktop) -->
                    <div class="insta-bio-container desktop-only">
                        <span class="insta-full-name">{{ user.name }}</span>
                        <p class="insta-bio-text">{{ user.bio || 'Community member and builder.' }}</p>
                    </div>
                </div>
            </div>

            <!-- Mobile Bio Section -->
            <div class="insta-bio-container mobile-only">
                <span class="insta-full-name">{{ user.name }}</span>
                <p class="insta-bio-text">{{ user.bio || 'Community member and builder.' }}</p>
            </div>

            <!-- Mobile Stats Row -->
            <div class="info-stats-row mobile-only" *ngIf="user.stats">
                <div class="mobile-stat"><span class="val">{{ user.stats.posts }}</span><span class="lab">posts</span>
                </div>
                <div class="mobile-stat"><span class="val">{{ user.stats.followers }}</span><span
                        class="lab">subscribers</span></div>
                <div class="mobile-stat"><span class="val">{{ user.stats.following }}</span><span
                        class="lab">subscriptions</span></div>
            </div>

            <!-- Profile Navigation Tabs -->
            <div class="insta-tabs-bar">
                <button class="insta-tab" [class.active]="activeTab === 'Posts'" (click)="setTab('Posts')">
                    <span class="material-symbols-outlined">grid_on</span>
                    <span>POSTS</span>
                </button>
                <button class="insta-tab" [class.active]="activeTab === 'Likes'" (click)="setTab('Likes')">
                    <span class="material-symbols-outlined">favorite_border</span>
                    <span>LIKED</span>
                </button>
                <button class="insta-tab" [class.active]="activeTab === 'About'" (click)="setTab('About')">
                    <span class="material-symbols-outlined">info</span>
                    <span>ABOUT</span>
                </button>
            </div>

            <!-- Post Grid Section (Replaced with Main Feed to match Home Page) -->
            <div class="post-list" *ngIf="activeTab === 'Posts'">
                <div class="empty-state-premium" *ngIf="!isLoading && posts.length === 0">
                    <div class="empty-icon-box"><span class="material-symbols-outlined">photo_camera</span></div>
                    <h3>No posts yet</h3>
                </div>

                <app-post-card *ngFor="let post of posts" [post]="post"></app-post-card>

                <!-- Infinite Scroll Loading Indicator -->
                <div class="infinite-scroll-status" *ngIf="isLoading" style="text-align: center; padding: 2rem;">
                    <div class="spinner-border text-primary shadow-sm" role="status">
                        <span class="visually-hidden">Loading more...</span>
                    </div>
                </div>

                <div class="empty-state-premium" *ngIf="!isMoreAvailable && posts.length > 0"
                    style="text-align: center; padding: 3rem; color: var(--text-secondary);">
                    <span class="material-symbols-outlined fs-1 mb-2">auto_awesome</span>
                    <p class="fw-bold">No more posts to show.</p>
                </div>
            </div>

            <!-- About Section Placeholder -->
            <div class="profile-card-premium" style="padding: 2rem;" *ngIf="activeTab === 'About'">
                <h2 class="feed-title" style="margin-bottom: 1.5rem;">About {{ user.name }}</h2>
                <div class="about-grid">
                    <div class="about-item">
                        <span class="material-symbols-outlined">badge</span>
                        <div>
                            <p class="stat-name">Full Name</p>
                            <p class="user-handle-premium" style="color: var(--text-main);">{{ user.name }}</p>
                        </div>
                    </div>
                    <div class="about-item" style="margin-top: 1.5rem;">
                        <span class="material-symbols-outlined">mail</span>
                        <div>
                            <p class="stat-name">Contact Handle</p>
                            <p class="user-handle-premium" style="color: var(--text-main);">@{{ user.handle }}</p>
                        </div>
                    </div>
                    <div class="about-item" style="margin-top: 1.5rem;">
                        <span class="material-symbols-outlined">calendar_today</span>
                        <div>
                            <p class="stat-name">Member Since</p>
                            <p class="user-handle-premium" style="color: var(--text-main);">{{ (user.createdAt |
                                date:'longDate') || 'January 2024' }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Media Section Placeholder -->
            <div class="empty-state-premium" style="margin-top: 1rem;" *ngIf="activeTab === 'Media'">
                <div class="empty-icon-box">
                    <span class="material-symbols-outlined">perm_media</span>
                </div>
                <h3>No media content found</h3>
                <p>This user hasn't shared any images or videos yet.</p>
            </div>

            <!-- Likes Section -->
            <div class="post-list" *ngIf="activeTab === 'Likes'">
                <ng-container *ngIf="isOwnProfile; else likesPrivateState">
                    <div class="infinite-scroll-status" *ngIf="isLikesLoading" style="text-align: center; padding: 2rem;">
                        <div class="spinner-border text-primary shadow-sm" role="status">
                            <span class="visually-hidden">Loading liked posts...</span>
                        </div>
                    </div>

                    <div class="empty-state-premium" *ngIf="!isLikesLoading && likedPosts.length === 0"
                        style="margin-top: 1rem;">
                        <div class="empty-icon-box">
                            <span class="material-symbols-outlined">favorite_border</span>
                        </div>
                        <h3>No liked posts yet</h3>
                        <p>Posts you like will appear here.</p>
                    </div>

                    <app-post-card *ngFor="let post of likedPosts" [post]="post"></app-post-card>
                </ng-container>
            </div>

            <ng-template #likesPrivateState>
                <div class="empty-state-premium" style="margin-top: 1rem;">
                    <div class="empty-icon-box">
                        <span class="material-symbols-outlined">lock</span>
                    </div>
                    <h3>Liked posts are private</h3>
                    <p>You can only view liked posts on your own profile.</p>
                </div>
            </ng-template>
        </main>

        <!-- Right Sidebar -->
        <app-right-sidebar class="sidebar"></app-right-sidebar>
    </div>
</div>
