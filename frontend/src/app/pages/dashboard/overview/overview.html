<div class="container-fluid py-4">
    <app-db-page-header title="Platform Overview" subtitle="Quick glimpse into the current state of the application."
        titleIcon="dashboard" iconColor="#0d6efd">
    </app-db-page-header>

    <!-- Stats Grid -->
    <div class="row g-4 mb-4" *ngIf="dataService.dashboardStats() as stats">
        <div class="col-sm-6 col-xl-3">
            <div class="card border-0 shadow-sm p-3 rounded-4 bg-white"
                style="border-bottom: 4px solid #6f42c1 !important;">
                <div class="d-flex align-items-center gap-3">
                    <div class="p-3 rounded-4" style="background-color: #f3e8ff; color: #6f42c1;">
                        <span class="material-symbols-outlined fs-2">group</span>
                    </div>
                    <div>
                        <p class="text-secondary small fw-bold mb-0">Total Users</p>
                        <h3 class="h4 fw-bolder mb-0">{{ stats.totalUsers | number }}</h3>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-sm-6 col-xl-3">
            <div class="card border-0 shadow-sm p-3 rounded-4 bg-white"
                style="border-bottom: 4px solid #198754 !important;">
                <div class="d-flex align-items-center gap-3">
                    <div class="p-3 rounded-4" style="background-color: #dcfce7; color: #198754;">
                        <span class="material-symbols-outlined fs-2">article</span>
                    </div>
                    <div>
                        <p class="text-secondary small fw-bold mb-0">Total Posts</p>
                        <h3 class="h4 fw-bolder mb-0">{{ stats.totalPosts | number }}</h3>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-sm-6 col-xl-3">
            <div class="card border-0 shadow-sm p-3 rounded-4 bg-white"
                style="border-bottom: 4px solid #fd7e14 !important;">
                <div class="d-flex align-items-center gap-3">
                    <div class="p-3 rounded-4" style="background-color: #fff7ed; color: #fd7e14;">
                        <span class="material-symbols-outlined fs-2">flag</span>
                    </div>
                    <div>
                        <p class="text-secondary small fw-bold mb-0">Active Reports</p>
                        <h3 class="h4 fw-bolder mb-0">{{ stats.pendingReports | number }}</h3>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-sm-6 col-xl-3">
            <div class="card border-0 shadow-sm p-3 rounded-4 bg-white"
                style="border-bottom: 4px solid #ef4444 !important;">
                <div class="d-flex align-items-center gap-3">
                    <div class="p-3 rounded-4" style="background-color: #fee2e2; color: #ef4444;">
                        <span class="material-symbols-outlined fs-2">block</span>
                    </div>
                    <div>
                        <p class="text-secondary small fw-bold mb-0">Banned Users</p>
                        <h3 class="h4 fw-bolder mb-0">{{ stats.bannedUsers | number }}</h3>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row g-4">

        <!-- Reported Users Section -->
        <div class="col-lg-4" *ngIf="dataService.dashboardStats() as stats">
            <div class="card border-0 shadow-sm rounded-4 bg-white h-100">
                <div class="card-header bg-white border-0 py-3 px-4 d-flex justify-content-between align-items-center">
                    <h3 class="h5 fw-bold mb-0">Alerts</h3>
                    <button class="btn btn-link text-primary text-decoration-none btn-sm fw-bold p-0"
                        routerLink="/dashboard/reports">View All</button>
                </div>
                <div class="card-body p-4 pt-0">
                    <div class="vstack gap-3 mt-2">
                        <div *ngFor="let user of stats.mostReportedUsers"
                            class="d-flex align-items-center gap-3 p-2 bg-light rounded-3 transition-all">
                            <div class="rounded-circle border border-2 shadow-sm"
                                style="width: 40px; height: 40px; background-size: cover;"
                                [style.background-image]="'url(' + (user.avatar || 'assets/default-avatar.png') + ')'">
                            </div>
                            <div class="flex-grow-1">
                                <p class="small fw-bold mb-0 line-clamp-1">{{ user.name }}</p>
                                <span class="badge rounded-pill px-2 py-1"
                                    style="font-size: 10px; background-color: #fff7ed; color: #fd7e14;">
                                    {{ user.reportCount }} Reports
                                </span>
                            </div>
                            <button
                                class="btn btn-white btn-sm rounded-circle p-1 shadow-sm d-flex align-items-center justify-content-center"
                                routerLink="/dashboard/reports">
                                <span class="material-symbols-outlined fs-6 text-primary fw-bold">chevron_right</span>
                            </button>
                        </div>
                        <app-db-feedback *ngIf="stats.mostReportedUsers.length === 0" type="empty"
                            icon="sentiment_satisfied" iconColor="#52c41a" title="All clear"
                            message="No critical alerts at the moment.">
                        </app-db-feedback>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <app-db-feedback *ngIf="isLoading()" type="loading"></app-db-feedback>
</div>