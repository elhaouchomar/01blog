<div class="superior-modal-container" *ngIf="post">
    <!-- Immersive Backdrop -->
    <div class="superior-backdrop" (click)="close()"></div>

    <div class="superior-window">
        <!-- UNIFIED CINEMATIC NAVBAR -->
        <nav class="superior-navbar">
            <button class="nav-control-btn back-trigger" (click)="close()" aria-label="Go back">
                <span class="material-symbols-outlined">west</span>
            </button>
            <div class="nav-spacer"></div>
            <app-action-menu [items]="postActions" (actionSelected)="handleDropdownAction($event)"
                buttonClass="nav-control-btn menu-trigger"></app-action-menu>
        </nav>

        <div class="superior-layout">

            <!-- CINEMATIC CONTENT PANE (Left) -->
            <div class="superior-content-pane no-scrollbar">
                <!-- Hero Section: Title & Metadata -->
                <header class="superior-hero-header">
                    <div class="superior-category-tag" *ngIf="post.category">{{ post.category }}</div>
                    <h1 class="superior-title">{{ post.title }}</h1>
                    <div class="superior-meta-strip">
                        <span class="meta-icon-group">
                            <span class="material-symbols-outlined">schedule</span>
                            {{ post.readTime || '5 min read' }}
                        </span>
                        <span class="meta-divider"></span>
                        <span class="meta-icon-group">
                            <span class="material-symbols-outlined">calendar_today</span>
                            {{ post.createdAt | date:'longDate' }}
                        </span>
                    </div>
                </header>

                <!-- Immersive Media Arena -->
                <div class="superior-media-arena" *ngIf="mediaItems.length > 0">
                    <div class="media-track-container">
                        <div class="media-filmstrip" [style.transform]="'translateX(-' + (currentSlide * 100) + '%)'">
                            <div class="media-frame" *ngFor="let media of mediaItems; trackBy: trackByMedia">
                                <div *ngIf="media.isVideo" class="video-stage">
                                    <video controls playsinline>
                                        <source [src]="media.url" type="video/mp4">
                                    </video>
                                </div>
                                <img *ngIf="!media.isVideo" [src]="media.url" alt="Post content" loading="eager">
                            </div>
                        </div>
                    </div>

                    <!-- Precision Navigation overlays -->
                    <ng-container *ngIf="mediaItems.length > 1">
                        <button class="nav-trigger prev" (click)="prevSlide()" [disabled]="currentSlide === 0">
                            <span class="material-symbols-outlined">west</span>
                        </button>
                        <button class="nav-trigger next" (click)="nextSlide()"
                            [disabled]="currentSlide === mediaItems.length - 1">
                            <span class="material-symbols-outlined">east</span>
                        </button>

                        <div class="arena-indicators">
                            <span class="indicator-dot" *ngFor="let dot of mediaItems; let i = index"
                                [class.active]="i === currentSlide" (click)="currentSlide = i"></span>
                        </div>
                    </ng-container>
                </div>

                <!-- Long-form Narrative -->
                <article class="superior-narrative">
                    <p class="narrative-text">{{ post.content }}</p>

                    <div class="narrative-footer" *ngIf="post.tags?.length">
                        <div class="tag-cloud">
                            <span class="pill-tag" *ngFor="let tag of post.tags">#{{ tag }}</span>
                        </div>
                    </div>
                </article>
            </div>

            <!-- INTELLIGENT ENGAGEMENT SIDEBAR (Right) -->
            <aside class="superior-engagement-sidebar">
                <!-- Author Mini Profile (Secondary) -->
                <div class="sidebar-top-bar">
                    <div class="author-capsule" (click)="goToProfile(post.user.id)">
                        <div class="avatar-aura">
                            <img [src]="post.user.avatar || 'assets/default-avatar.png'" alt="Author">
                        </div>
                        <div class="author-info">
                            <span class="author-name">{{ post.user.name }}</span>
                            <span class="author-handle">@{{ post.user.handle }}</span>
                        </div>
                    </div>
                </div>

                <!-- Discussion Nodes Timeline -->
                <div class="sidebar-scroll-zone no-scrollbar">
                    <!-- Dynamic Comments -->
                    <div class="comments-vortex">
                        <div *ngIf="hasMoreComments" class="load-more-wrapper">
                            <button class="btn-load-more" (click)="loadMoreComments()">
                                <span class="material-symbols-outlined">refresh</span>
                                Load previous comments
                            </button>
                        </div>

                        <div *ngFor="let comment of comments; trackBy: trackByComment"
                            class="timeline-node comment-node">
                            <div class="node-avatar" (click)="goToProfile(comment.user.id)" style="cursor: pointer;">
                                <img [src]="comment.user.avatar || 'assets/default-avatar.png'" alt="">
                            </div>
                            <div class="node-content">
                                <div class="node-bubble">
                                    <span class="node-author-name" (click)="goToProfile(comment.user.id)"
                                        style="cursor: pointer;">{{ comment.user.name }}</span>
                                    <span class="node-body">{{ comment.content }}</span>
                                </div>
                                <div class="node-meta">
                                    <span>{{ comment.time || 'now' }}</span>
                                    <span class="node-likes">{{ comment.likes || 0 }} likes</span>
                                </div>
                            </div>
                            <button class="node-heart" [class.active]="comment.isLiked"
                                (click)="toggleCommentLike(comment)">
                                <span class="material-symbols-outlined">favorite</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- High-Performance Interaction Footer -->
                <footer class="sidebar-bottom-panel">
                    <div class="interaction-dashboard">
                        <div class="primary-actions">
                            <button class="dash-btn heart" [class.active]="post.isLiked" (click)="toggleLike()">
                                <span class="material-symbols-outlined" [class.filled]="post.isLiked">
                                    {{ post.isLiked ? 'favorite' : 'favorite_border' }}
                                </span>
                            </button>
                        </div>
                    </div>

                    <div class="engagement-summary">
                        <span class="likes-count">{{ post.likes | number }} people like this</span>
                        <span class="post-timestamp">{{ post.createdAt | date:'longDate' }}</span>
                    </div>

                    <div class="comment-composer">
                        <div class="composer-inner">
                            <span class="material-symbols-outlined composer-icon">add_comment</span>
                            <input type="text" placeholder="Add a perspective..." [(ngModel)]="newComment"
                                [disabled]="isSubmitting" (keyup.enter)="addComment()">
                            <button class="send-trigger" [disabled]="!newComment.trim() || isSubmitting"
                                (click)="addComment()">
                                <span class="material-symbols-outlined">{{ isSubmitting ? 'sync' : 'arrow_upward'
                                    }}</span>
                            </button>
                        </div>
                    </div>
                </footer>
            </aside>
        </div>
    </div>
</div>