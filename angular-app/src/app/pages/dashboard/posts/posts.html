<div class="page-header">
    <div>
        <h2 class="section-title">Posts Management</h2>
        <p class="section-subtitle">Review, moderate and manage all platform content.</p>
    </div>
    <div class="header-actions">
        <button class="btn btn-export" (click)="exportPosts()">
            <span class="material-symbols-outlined">download</span>
            Export
        </button>
        <button class="btn btn-primary" (click)="modalService.open('create-post')">
            <span class="material-symbols-outlined">add</span>
            Create Post
        </button>
    </div>
</div>

<div class="filters-bar">
    <div class="filter-group">
        <div class="search-box">
            <span class="material-symbols-outlined">search</span>
            <input type="text" placeholder="Filter by author or keyword..." [ngModel]="searchQuery()"
                (input)="searchQuery.set($any($event.target).value)">
        </div>

        <div class="select-box">
            <span class="material-symbols-outlined icon">filter_list</span>
            <select [ngModel]="statusFilter()" (change)="statusFilter.set($any($event.target).value)">
                <option value="">All Statuses</option>
                <option value="published">Published</option>
                <option value="flagged">Flagged</option>
                <option value="hidden">Hidden</option>
            </select>
        </div>

        <div class="select-box">
            <span class="material-symbols-outlined icon">sort</span>
            <select [ngModel]="sortBy()" (change)="sortBy.set($any($event.target).value)">
                <option value="newest">Newest First</option>
                <option value="most-liked">Most Liked</option>
                <option value="most-reported">Most Reported</option>
            </select>
        </div>
    </div>
</div>

<div class="data-table-container">
    <div class="table-scroll">
        <table class="data-table">
            <thead>
                <tr>
                    <th class="text-center w-media">Media</th>
                    <th>Content & Author</th>
                    <th>Stats</th>
                    <th>Reports</th>
                    <th>Status</th>
                    <th class="text-right">Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let post of paginatedPosts()">
                    <td class="text-center">
                        <div class="post-media" (click)="reviewPost(post)" style="cursor: pointer;"
                            [style.background-image]="'url(' + (post.images?.[0] || 'assets/default-post.png') + ')'">
                        </div>
                    </td>
                    <td>
                        <div class="content-cell">
                            <p class="post-title" (click)="reviewPost(post)"
                                style="cursor: pointer; color: var(--text-main);">{{ post.title }}</p>
                            <div class="post-meta">
                                <div class="author-avatar"
                                    [style.background-image]="'url(' + (post.user.avatar || 'assets/default-avatar.png') + ')'">
                                </div>
                                <a [routerLink]="['/profile', post.user.id]" class="author-name"
                                    style="text-decoration: none; color: var(--text-secondary); transition: color 0.2s;">{{
                                    post.user.name }}</a>
                                <span class="dot">â€¢</span>
                                <span class="date">{{ post.createdAt | date:'shortTime' }} ago</span>
                            </div>
                        </div>
                    </td>
                    <td>
                        <div class="stats-cell">
                            <span class="stat"><span class="material-symbols-outlined">favorite</span> {{
                                post.likes || 0 }}</span>
                            <span class="stat"><span class="material-symbols-outlined">chat_bubble</span> {{
                                post.comments || 0 }}</span>
                        </div>
                    </td>
                    <td>
                        <div *ngIf="(post.reportsCount || 0) > 0" class="reports-badge">
                            <span class="material-symbols-outlined">warning</span>
                            {{ post.reportsCount }}
                        </div>
                        <span *ngIf="!(post.reportsCount || 0)" class="no-reports">-</span>
                    </td>
                    <td>
                        <span class="status-badge" [class]="'published'">Published</span>
                    </td>
                    <td class="text-right">
                        <div class="action-buttons">
                            <button class="action-btn" title="Review Content" (click)="reviewPost(post)">
                                <span class="material-symbols-outlined">visibility</span>
                            </button>
                            <button class="action-btn delete" title="Delete Post" (click)="deletePost(post)">
                                <span class="material-symbols-outlined">delete</span>
                            </button>
                        </div>
                    </td>
                </tr>
                <tr *ngIf="filteredPosts().length === 0 && !isLoading()">
                    <td colspan="6" class="empty-cell">No posts found</td>
                </tr>
                <tr *ngIf="isLoading()">
                    <td colspan="6" class="loading-cell">Loading posts...</td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="table-footer">
        <p class="stats">Showing {{ getPageStart() }} - {{ getPageEnd() }} of {{ filteredPosts().length }} posts</p>
        <div class="pagination">
            <button class="btn-pager" [disabled]="currentPage() === 1" (click)="previousPage()">
                <span class="material-symbols-outlined">chevron_left</span>
                Previous
            </button>
            <span class="page-indicator">Page {{ currentPage() }} of {{ totalPages() }}</span>
            <button class="btn-pager" [disabled]="currentPage() === totalPages()" (click)="nextPage()">
                Next
                <span class="material-symbols-outlined">chevron_right</span>
            </button>
        </div>
    </div>
</div>